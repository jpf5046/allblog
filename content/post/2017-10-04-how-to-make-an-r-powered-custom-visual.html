---
title: How to Make an R Powered Custom Visual
author: John F
date: '2017-10-04'
slug: how-to-make-an-r-powered-custom-visual
categories:
  - Power BI
  - Custom Visual
tags:
  - R
  - Power BI
---

<script src="/rmarkdown-libs/htmlwidgets/htmlwidgets.js"></script>
<link href="/rmarkdown-libs/plotlyjs/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="/rmarkdown-libs/plotlyjs/plotly-latest.min.js"></script>
<script src="/rmarkdown-libs/plotly-binding/plotly.js"></script>


<div id="power-bi-custom-visuals" class="section level2">
<h2>Power BI Custom Visuals</h2>
<p>This is a walkthrough on creating custom visuals for Power BI, specifically, R powered custom Visuals. The end product will be similar to the custom visuals found <a href="https://powerbi.microsoft.com/en-us/documentation/powerbi-desktop-r-powered-custom-visuals/">here</a>.</p>
<p>By the end of this tutorial we will have the following Plotly Scatter 3D chart–fully interactive in Power BI as a custom visual.</p>
<pre><code>## Warning: package &#39;bindrcpp&#39; was built under R version 3.3.3</code></pre>
<div id="htmlwidget-2208" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-2208">{"x":{"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"scene":{"xaxis":{"title":"Weight"},"yaxis":{"title":"Gross horsepower"},"zaxis":{"title":"1/4 mile time"}},"showlegend":false,"xaxis":{"domain":[0,1]},"yaxis":{"domain":[0,1]}},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"modeBarButtonsToRemove":["sendDataToCloud"]},"data":[{"x":[2.62,2.875,2.32,3.215,3.44,3.46,3.57,3.19,3.15,3.44,3.44,4.07,3.73,3.78,5.25,5.424,5.345,2.2,1.615,1.835,2.465,3.52,3.435,3.84,3.845,1.935,2.14,1.513,3.17,2.77,3.57,2.78],"y":[110,110,93,110,175,105,245,62,95,123,123,180,180,180,205,215,230,66,52,65,97,150,150,245,175,66,91,113,264,175,335,109],"z":[16.46,17.02,18.61,19.44,17.02,20.22,15.84,20,22.9,18.3,18.9,17.4,17.6,18,17.98,17.82,17.42,19.47,18.52,19.9,20.01,16.87,17.3,15.41,17.05,18.9,16.7,16.9,14.5,15.5,14.6,18.6],"type":"scatter3d","mode":"markers","marker":{"colorbar":{"title":"cyl","ticklen":2},"cmin":4,"cmax":8,"colorscale":[["0","rgba(191,56,42,1)"],["0","rgba(191,56,42,1)"],["0","rgba(191,56,42,1)"],["0","rgba(191,56,42,1)"],["0","rgba(191,56,42,1)"],["0","rgba(191,56,42,1)"],["0","rgba(191,56,42,1)"],["0","rgba(191,56,42,1)"],["0.166666666666666","rgba(173,62,60,1)"],["0.5","rgba(134,69,93,1)"],["0.5","rgba(134,69,93,1)"],["0.5","rgba(134,69,93,1)"],["0.5","rgba(134,69,93,1)"],["0.5","rgba(134,69,93,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"]],"showscale":false,"color":[6,6,4,6,8,6,8,4,4,6,6,8,8,8,8,8,8,4,4,4,4,8,8,8,8,4,4,4,8,6,8,4],"line":{"color":"transparent"}}},{"x":[1.513,5.424],"y":[52,335],"type":"scatter3d","mode":"markers","opacity":0,"hoverinfo":"none","showlegend":false,"marker":{"colorbar":{"title":"cyl","ticklen":2},"cmin":4,"cmax":8,"colorscale":[["0","rgba(191,56,42,1)"],["0","rgba(191,56,42,1)"],["0","rgba(191,56,42,1)"],["0","rgba(191,56,42,1)"],["0","rgba(191,56,42,1)"],["0","rgba(191,56,42,1)"],["0","rgba(191,56,42,1)"],["0","rgba(191,56,42,1)"],["0.166666666666666","rgba(173,62,60,1)"],["0.5","rgba(134,69,93,1)"],["0.5","rgba(134,69,93,1)"],["0.5","rgba(134,69,93,1)"],["0.5","rgba(134,69,93,1)"],["0.5","rgba(134,69,93,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"],["1","rgba(12,75,142,1)"]],"showscale":true,"color":[4,8]},"z":[14.5,22.9]}],"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
<p>There are five steps to creating custom visuals in Power BI. This guide will cover all of them. Here is the list of steps:</p>
<ol style="list-style-type: decimal">
<li>Download and Install <a href="https://nodejs.org/en/">node.js</a></li>
<li>Generate a pre-Packaged visual with node.js</li>
<li>Edit packaged visual in a Rstudio</li>
<li>Complie Visual in cmd line</li>
<li>Import into Power BI</li>
</ol>
<div id="step-one-installing-node.js" class="section level3">
<h3>Step One, Installing node.js</h3>
<p>Easiest part. Use the link above.</p>
</div>
<div id="step-two-create-a-pre-packaged-visual-with-node.js" class="section level3">
<h3>Step Two, Create a Pre Packaged Visual with node.js</h3>
<ol style="list-style-type: decimal">
<li>Open command line and type in the following: <code>pbiviz new Rpoweredcustomvisual - t rhtml</code>
<ul>
<li><code>Rpoweredcustomvisual</code> can be anything the user wants to name the visual</li>
</ul></li>
<li>Then type <code>cd Rpoweredcustomvisual</code></li>
<li>Then type <code>npm i powerbi-visuals-utils-dataviewutils</code></li>
<li>Then type <code>pbiviz start</code></li>
</ol>
<p>There you go, your command line should look like this: <img src="/images/CommandLineAfterRvisualpromt.PNG" /> </p>
<p><strong>Before we move to step 3</strong> Let’s look at what we created in step 2.</p>
<ol style="list-style-type: decimal">
<li>Go to your User folder, open the User folder you are using</li>
<li>Look for a file named <code>RpoweredCustomvisual</code>
<ul>
<li>…or whatever was decided to name the visual</li>
</ul></li>
<li>Open the folder</li>
</ol>
<p>It should look exactly like this:</p>
<p><img src="/images/What%20the%20Packaged%20R%20Visual%20Looks%20like.PNG" /> </p>
</div>
<div id="step-three-edit-the-folder-we-created-in-step-two" class="section level3">
<h3>Step Three, Edit the folder we created in Step Two</h3>
<p>Edit the R script found in the file created in Step Two.</p>
<div class="figure">
<img src="/images/Rscipt%20location.PNG" />

</div>
<p>We open up the Rscript and see the following code:</p>
<div class="figure">
<img src="/images/What%20the%20R%20Script%20Looks%20Like%20before.PNG" />

</div>
<p><strong>Then we make our R code changes</strong></p>
<p>Let’s copy and paste our plotly code:</p>
<pre class="r"><code>p &lt;- Values %&gt;%
  plot_ly( x = ~wt, y = ~hp, z = ~qsec, color = ~cyl, colors = c(&#39;#BF382A&#39;, &#39;#0C4B8E&#39;)) %&gt;%
  add_markers() %&gt;%
  layout(scene = list(xaxis = list(title = &#39;Weight&#39;),
                      yaxis = list(title = &#39;Gross horsepower&#39;),
                      zaxis = list(title = &#39;1/4 mile time&#39;)));

internalSaveWidget(p, &#39;out.html&#39;);</code></pre>
<p>We see the new R code in our Rscript file now. Now we overwrite this new R script and save in our <code>Rpoweredcustomvisual</code> folder.</p>
<div class="figure">
<img src="/images/What%20the%20code%20looks%20like%20after%20changing%20R%20Script%204.PNG" />

</div>
<p>After saving the file, we made all the changes neccessary. Let’s package the visual and bring it into Power BI.</p>
</div>
<div id="step-four-package-the-visual" class="section level3">
<h3>Step Four, Package the Visual</h3>
<ol style="list-style-type: decimal">
<li>Go back to your command line an type <code>pbiviz package</code> – you might have to type <code>ctrl+c</code> to terminate listening</li>
</ol>
<div class="figure">
<img src="/images/packageVisual.PNG" />

</div>
<ol start="2" style="list-style-type: decimal">
<li>Go to the same file you created in step two, there is going to be a new folder</li>
</ol>
<div class="figure">
<img src="/images/new%20fodler%20created%20after%20PACKAGE%20step.PNG" />

</div>
<p>This is your news packaged Power BI custom visual, this is the file you choose in step five.</p>
</div>
<div id="step-five-bring-into-power-bi" class="section level3">
<h3>Step Five, Bring into Power BI</h3>
<ol style="list-style-type: decimal">
<li>Import Custom Visual</li>
</ol>
<div class="figure">
<img src="/images/Import%20custom%20Visual%20Power%20BI.PNG" />

</div>
<ol start="2" style="list-style-type: decimal">
<li>Go to the <code>Rpoweredcustomvisual</code> folder created in step two, delect the <code>dist</code> folder</li>
</ol>
<div class="figure">
<img src="/images/CustomVisual%20in%20folder.PNG" />

</div>
<ol start="3" style="list-style-type: decimal">
<li><p>Select your visual</p></li>
<li><p>Create data – make sure column names are the same as the R code</p></li>
</ol>
<div class="figure">
<img src="/images/random%20data%20for%20visual.PNG" />

</div>
<ol start="5" style="list-style-type: decimal">
<li><p>Put the custom visual on the Power BI canvas</p></li>
<li><p>Drag and drop the data fields into the visual.</p></li>
<li><p>Your final visual should look like this:</p></li>
</ol>
<iframe width="560" height="315" src="https://www.youtube.com/embed/cqqa3EhFS1c" frameborder="0" allowfullscreen>
</iframe>
</div>
</div>
